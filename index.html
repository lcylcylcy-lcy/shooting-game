<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªç©ºå°„æ“ŠéŠæˆ² - è·æ¥­èˆ‡çš®è†šç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
        }
        
        /* ä¸»èœå–®æ¨£å¼ */
        #main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .menu-title {
            font-size: 48px;
            margin-bottom: 30px;
            color: #f1c40f;
            text-shadow: 0 0 10px #f39c12;
        }
        
        .menu-btn {
            padding: 15px 30px;
            margin: 10px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
            text-align: center;
        }
        
        .menu-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #3498db;
        }
        
        .menu-btn.play {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .menu-btn.shop {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .menu-btn.exit {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        /* è·æ¥­é¸æ“‡ç•Œé¢ */
        #class-select {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 95;
        }
        
        .class-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
            margin-bottom: 30px;
        }
        
        .class-card {
            width: 180px;
            height: 220px;
            margin: 15px;
            background: radial-gradient(circle, #34495e, #2c3e50);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            border: 3px solid #3498db;
        }
        
        .class-card.selected {
            border-color: #f1c40f;
            box-shadow: 0 0 20px #f1c40f;
        }
        
        .class-card.locked {
            filter: brightness(0.5);
            cursor: not-allowed;
        }
        
        .class-card.locked::after {
            content: 'ğŸ”’';
            position: absolute;
            font-size: 40px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .class-emoji {
            font-size: 60px;
            margin: 10px 0;
        }
        
        .class-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #f1c40f;
        }
        
        .class-stats {
            font-size: 12px;
            text-align: center;
            color: #bdc3c7;
        }
        
        .class-desc {
            font-size: 12px;
            margin-top: 10px;
            text-align: center;
            color: #7f8c8d;
        }
        
        /* é—œå¡é¸æ“‡ç•Œé¢ */
        #level-select {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 90;
        }
        
        .level-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 600px;
        }
        
        .level-btn {
            width: 100px;
            height: 100px;
            margin: 15px;
            background: radial-gradient(circle, #34495e, #2c3e50);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .level-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent
            );
            transform: rotate(45deg);
            transition: all 0.5s;
        }
        
        .level-btn:hover::before {
            left: 100%;
        }
        
        .level-btn.easy {
            border: 3px solid #2ecc71;
            color: #2ecc71;
        }
        
        .level-btn.medium {
            border: 3px solid #f1c40f;
            color: #f1c40f;
        }
        
        .level-btn.hard {
            border: 3px solid #e74c3c;
            color: #e74c3c;
        }
        
        .level-btn.boss {
            border: 3px solid #9b59b6;
            color: #9b59b6;
            animation: pulse 1.5s infinite;
        }
        
        .level-btn.locked {
            filter: brightness(0.5);
            cursor: not-allowed;
        }
        
        .level-btn.locked::after {
            content: 'ğŸ”’';
            position: absolute;
            font-size: 30px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(155, 89, 182, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(155, 89, 182, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(155, 89, 182, 0); }
        }
        
        .back-btn {
            margin-top: 30px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
        }
        
        /* å•†åº—ç•Œé¢ */
        #shop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 85;
        }
        
        .shop-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
            margin-bottom: 30px;
        }
        
        .shop-tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        
        .shop-tab-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 5px 5px 0 0;
            color: white;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .shop-tab-btn.active {
            background: rgba(255, 255, 255, 0.3);
            color: #f1c40f;
        }
        
        .skin-card {
            width: 120px;
            height: 150px;
            margin: 10px;
            background: radial-gradient(circle, #34495e, #2c3e50);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            border: 2px solid #3498db;
        }
        
        .skin-card.selected {
            border-color: #f1c40f;
            box-shadow: 0 0 15px #f1c40f;
        }
        
        .skin-card.locked {
            filter: brightness(0.5);
            cursor: not-allowed;
        }
        
        .skin-card.locked::after {
            content: 'ğŸ”’';
            position: absolute;
            font-size: 30px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .skin-emoji {
            font-size: 50px;
            margin: 10px 0;
        }
        
        .skin-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #f1c40f;
        }
        
        .skin-price {
            font-size: 12px;
            color: #bdc3c7;
            margin-top: auto;
        }
        
        .skin-price span {
            color: #f1c40f;
        }
        
        /* æŠ½çç•Œé¢ */
        #loot-box {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 80;
        }
        
        .loot-box-container {
            width: 300px;
            height: 400px;
            background: radial-gradient(circle, #8e44ad, #6c3483);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            border: 5px solid #f1c40f;
            box-shadow: 0 0 30px #f1c40f;
        }
        
        .loot-box-title {
            font-size: 24px;
            color: #f1c40f;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .loot-box-cost {
            font-size: 16px;
            margin-bottom: 20px;
            color: white;
        }
        
        .loot-box-cost span {
            color: #f1c40f;
            font-weight: bold;
        }
        
        .loot-box-preview {
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .loot-box-result {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            background: rgba(0, 0, 0, 0.7);
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .loot-box-result.show {
            opacity: 1;
        }
        
        .loot-box-buttons {
            display: flex;
            width: 100%;
            justify-content: space-around;
        }
        
        .loot-box-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .loot-box-buy {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .loot-box-close {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        /* éŠæˆ²ç•Œé¢ */
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: none;
            overflow: hidden;
        }
        
        #background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            z-index: -1;
        }
        
        #player {
            position: absolute;
            width: 60px;
            height: 60px;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: radial-gradient(circle at center, #2ecc71, #27ae60);
            border-radius: 50%;
            z-index: 10;
            transition: left 0.1s ease-out;
            box-shadow: 0 0 20px #2ecc71;
            font-size: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .enemy {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            text-shadow: 0 0 5px black;
        }
        
        .enemy.normal {
            background: radial-gradient(circle at center, #e74c3c, #c0392b);
        }
        
        .enemy.fast {
            background: radial-gradient(circle at center, #3498db, #2980b9);
        }
        
        .enemy.tank {
            background: radial-gradient(circle at center, #7f8c8d, #34495e);
        }
        
        .enemy.boss {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at center, #9b59b6, #8e44ad);
            font-size: 50px;
            animation: bossPulse 1s infinite alternate;
        }
        
        @keyframes bossPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        .bullet {
            position: absolute;
            width: 6px;
            height: 15px;
            background: linear-gradient(to bottom, #f1c40f, #f39c12);
            border-radius: 3px;
            z-index: 8;
            box-shadow: 0 0 10px #f1c40f;
        }
        
        .special-bullet {
            position: absolute;
            width: 10px;
            height: 20px;
            border-radius: 5px;
            z-index: 8;
            box-shadow: 0 0 15px currentColor;
        }
        
        #hud {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            z-index: 20;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .hud-item {
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .hud-value {
            font-size: 18px;
            font-weight: bold;
            color: #f1c40f;
        }
        
        .hud-label {
            font-size: 12px;
            color: #ecf0f1;
        }
        
        #health-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        
        #health-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            width: 100%;
            transition: width 0.3s;
        }
        
        #boss-health-bar {
            position: absolute;
            top: 60px;
            left: 10%;
            width: 80%;
            height: 10px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 20;
            display: none;
        }
        
        #boss-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            width: 100%;
            transition: width 0.3s;
        }
        
        .explosion {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #f39c12 0%, #e67e22 70%, transparent 100%);
            border-radius: 50%;
            z-index: 9;
            animation: explode 0.5s forwards;
        }
        
        @keyframes explode {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .floating-text {
            position: absolute;
            font-weight: bold;
            font-size: 18px;
            z-index: 6;
            animation: floatUp 1s forwards;
            text-shadow: 0 0 5px currentColor;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        
        #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
        }
        
        #game-over h2 {
            color: #e74c3c;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #e74c3c;
        }
        
        #restart-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        #level-complete {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
        }
        
        #level-complete h2 {
            color: #2ecc71;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #27ae60;
        }
        
        .controls-info {
            position: absolute;
            bottom: 10px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: #7f8c8d;
            z-index: 15;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 1; }
        }
        
        /* é€šçŸ¥æ¶ˆæ¯ */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #f1c40f;
            border-radius: 5px;
            color: #f1c40f;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .notification.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- ä¸»èœå–® -->
    <div id="main-menu">
        <h1 class="menu-title">å¤ªç©ºå°„æ“ŠéŠæˆ²</h1>
        <button class="menu-btn play" id="play-btn">é–‹å§‹éŠæˆ²</button>
        <button class="menu-btn shop" id="shop-btn">å•†åº— & çš®è†š</button>
        <button class="menu-btn exit" id="exit-btn">é€€å‡ºéŠæˆ²</button>
    </div>
    
    <!-- è·æ¥­é¸æ“‡ -->
    <div id="class-select">
        <h2>é¸æ“‡ä½ çš„é£›èˆ¹è·æ¥­</h2>
        <div class="class-container" id="class-container">
            <div class="class-card" data-class="fighter">
                <div class="class-emoji">ğŸš€</div>
                <div class="class-name">æˆ°é¬¥æ©Ÿ</div>
                <div class="class-stats">æ”»é€Ÿ: â˜…â˜…â˜…â˜…â˜†<br>å‚·å®³: â˜…â˜…â˜…â˜†â˜†<br>ç”Ÿå‘½: â˜…â˜…â˜…â˜†â˜†</div>
                <div class="class-desc">å¹³è¡¡å‹é£›èˆ¹ï¼Œé©åˆæ–°æ‰‹ç©å®¶</div>
            </div>
            <div class="class-card" data-class="sniper">
                <div class="class-emoji">ğŸ”­</div>
                <div class="class-name">ç‹™æ“Šæ‰‹</div>
                <div class="class-stats">æ”»é€Ÿ: â˜…â˜…â˜†â˜†â˜†<br>å‚·å®³: â˜…â˜…â˜…â˜…â˜…<br>ç”Ÿå‘½: â˜…â˜…â˜†â˜†â˜†</div>
                <div class="class-desc">é«˜å‚·å®³ä½å°„é€Ÿï¼Œç²¾æº–æ‰“æ“Š</div>
            </div>
            <div class="class-card" data-class="tank">
                <div class="class-emoji">ğŸ›¡ï¸</div>
                <div class="class-name">å¦å…‹</div>
                <div class="class-stats">æ”»é€Ÿ: â˜…â˜…â˜†â˜†â˜†<br>å‚·å®³: â˜…â˜…â˜†â˜†â˜†<br>ç”Ÿå‘½: â˜…â˜…â˜…â˜…â˜…</div>
                <div class="class-desc">é«˜ç”Ÿå‘½å€¼ï¼Œé©åˆç”Ÿå­˜</div>
            </div>
            <div class="class-card" data-class="assault">
                <div class="class-emoji">ğŸ’¥</div>
                <div class="class-name">çªæ“Šå…µ</div>
                <div class="class-stats">æ”»é€Ÿ: â˜…â˜…â˜…â˜…â˜…<br>å‚·å®³: â˜…â˜…â˜†â˜†â˜†<br>ç”Ÿå‘½: â˜…â˜…â˜†â˜†â˜†</div>
                <div class="class-desc">è¶…é«˜å°„é€Ÿï¼Œç«åŠ›å£“åˆ¶</div>
            </div>
            <div class="class-card locked" data-class="ninja">
                <div class="class-emoji">ğŸ¥·</div>
                <div class="class-name">å¿è€…</div>
                <div class="class-stats">æ”»é€Ÿ: â˜…â˜…â˜…â˜…â˜†<br>å‚·å®³: â˜…â˜…â˜…â˜…â˜†<br>ç”Ÿå‘½: â˜…â˜…â˜…â˜†â˜†</div>
                <div class="class-desc">è§£é–å¾Œå¯è¦‹</div>
            </div>
            <div class="class-card locked" data-class="wizard">
                <div class="class-emoji">ğŸ§™</div>
                <div class="class-name">å·«å¸«</div>
                <div class="class-stats">æ”»é€Ÿ: â˜…â˜…â˜…â˜†â˜†<br>å‚·å®³: â˜…â˜…â˜…â˜…â˜†<br>ç”Ÿå‘½: â˜…â˜…â˜…â˜…â˜†</div>
                <div class="class-desc">è§£é–å¾Œå¯è¦‹</div>
            </div>
        </div>
        <button class="back-btn" id="back-to-menu-from-class">è¿”å›ä¸»èœå–®</button>
    </div>
    
    <!-- é—œå¡é¸æ“‡ -->
    <div id="level-select">
        <h2>é¸æ“‡é—œå¡</h2>
        <div class="level-container" id="level-container">
            <div class="level-btn easy" data-level="1">1</div>
            <div class="level-btn easy locked" data-level="2">2</div>
            <div class="level-btn medium locked" data-level="3">3</div>
            <div class="level-btn medium locked" data-level="4">4</div>
            <div class="level-btn hard locked" data-level="5">5</div>
            <div class="level-btn boss locked" data-level="boss">BOSS</div>
        </div>
        <button class="back-btn" id="back-to-menu-from-level">è¿”å›ä¸»èœå–®</button>
    </div>
    
    <!-- å•†åº—ç•Œé¢ -->
    <div id="shop">
        <div class="shop-tab-buttons">
            <button class="shop-tab-btn active" data-tab="skins">é£›èˆ¹çš®è†š</button>
            <button class="shop-tab-btn" data-tab="loot-box">æŠ½çç®±</button>
        </div>
        <div class="shop-container" id="skins-tab">
            <div class="skin-card selected" data-skin="default">
                <div class="skin-emoji">ğŸš€</div>
                <div class="skin-name">é»˜èªçš®è†š</div>
                <div class="skin-price">å·²æ“æœ‰</div>
            </div>
            <div class="skin-card" data-skin="ufo">
                <div class="skin-emoji">ğŸ›¸</div>
                <div class="skin-name">UFO</div>
                <div class="skin-price">åƒ¹æ ¼: <span>1000</span> åˆ†</div>
            </div>
            <div class="skin-card" data-skin="rocket">
                <div class="skin-emoji">ğŸš€</div>
                <div class="skin-name">ç«ç®­</div>
                <div class="skin-price">åƒ¹æ ¼: <span>1500</span> åˆ†</div>
            </div>
            <div class="skin-card locked" data-skin="dragon">
                <div class="skin-emoji">ğŸ‰</div>
                <div class="skin-name">é¾é£›èˆ¹</div>
                <div class="skin-price">è§£é–æ¢ä»¶: é€šéç¬¬3é—œ</div>
            </div>
            <div class="skin-card locked" data-skin="alien">
                <div class="skin-emoji">ğŸ‘½</div>
                <div class="skin-name">å¤–æ˜Ÿäºº</div>
                <div class="skin-price">è§£é–æ¢ä»¶: é€šéç¬¬5é—œ</div>
            </div>
            <div class="skin-card locked" data-skin="ghost">
                <div class="skin-emoji">ğŸ‘»</div>
                <div class="skin-name">å¹½éˆé£›èˆ¹</div>
                <div class="skin-price">è§£é–æ¢ä»¶: æ“Šæ•—BOSS</div>
            </div>
        </div>
        <div class="shop-container" id="loot-box-tab" style="display: none;">
            <div class="skin-card" data-loot="common">
                <div class="skin-emoji">ğŸ“¦</div>
                <div class="skin-name">æ™®é€šæŠ½çç®±</div>
                <div class="skin-price">åƒ¹æ ¼: <span>500</span> åˆ†</div>
            </div>
            <div class="skin-card" data-loot="rare">
                <div class="skin-emoji">ğŸ</div>
                <div class="skin-name">ç¨€æœ‰æŠ½çç®±</div>
                <div class="skin-price">åƒ¹æ ¼: <span>1000</span> åˆ†</div>
            </div>
            <div class="skin-card" data-loot="legendary">
                <div class="skin-emoji">ğŸ’</div>
                <div class="skin-name">å‚³èªªæŠ½çç®±</div>
                <div class="skin-price">åƒ¹æ ¼: <span>2000</span> åˆ†</div>
            </div>
        </div>
        <button class="back-btn" id="back-to-menu-from-shop">è¿”å›ä¸»èœå–®</button>
    </div>
    
    <!-- æŠ½çç•Œé¢ -->
    <div id="loot-box">
        <div class="loot-box-container">
            <div class="loot-box-title">æ™®é€šæŠ½çç®±</div>
            <div class="loot-box-cost">èŠ±è²»: <span>500</span> åˆ†</div>
            <div class="loot-box-preview">
                <div class="loot-box-result"></div>
                ğŸ“¦
            </div>
            <div class="loot-box-buttons">
                <button class="loot-box-btn loot-box-buy" id="buy-loot-box">è³¼è²·</button>
                <button class="loot-box-btn loot-box-close" id="close-loot-box">é—œé–‰</button>
            </div>
        </div>
    </div>
    
    <!-- éŠæˆ²ç•Œé¢ -->
    <div id="game-container">
        <div id="background"></div>
        <div id="hud">
            <div class="hud-item">
                <div class="hud-value" id="score">0</div>
                <div class="hud-label">åˆ†æ•¸</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="level">1</div>
                <div class="hud-label">é—œå¡</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="fire-rate">3.0</div>
                <div class="hud-label">æ”»é€Ÿ/ç§’</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="damage">15</div>
                <div class="hud-label">å‚·å®³</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="coins">0</div>
                <div class="hud-label">é‡‘å¹£</div>
            </div>
        </div>
        
        <div id="player">ğŸš€</div>
        <div id="health-bar"><div id="health-fill"></div></div>
        <div id="boss-health-bar"><div id="boss-health-fill"></div></div>
        
        <div class="controls-info">
            ä½¿ç”¨ â† â†’ éµæˆ–è§¸æ‘¸å±å¹•ç§»å‹• | è‡ªå‹•å°„æ“Š
        </div>
        
        <div id="game-over">
            <h2>éŠæˆ²çµæŸ</h2>
            <div class="hud-item">
                <div class="hud-value" id="final-score">0</div>
                <div class="hud-label">æœ€çµ‚åˆ†æ•¸</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="final-level">1</div>
                <div class="hud-label">é”æˆé—œå¡</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="coins-earned">+0</div>
                <div class="hud-label">ç²å¾—é‡‘å¹£</div>
            </div>
            <button id="restart-btn">é‡æ–°é–‹å§‹</button>
        </div>
        
        <div id="level-complete">
            <h2>é—œå¡å®Œæˆ!</h2>
            <div class="hud-item">
                <div class="hud-value" id="complete-score">0</div>
                <div class="hud-label">ç²å¾—åˆ†æ•¸</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="next-level">2</div>
                <div class="hud-label">è§£é–é—œå¡</div>
            </div>
            <div class="hud-item">
                <div class="hud-value" id="coins-reward">+0</div>
                <div class="hud-label">ç²å¾—é‡‘å¹£</div>
            </div>
            <button id="continue-btn">ç¹¼çºŒéŠæˆ²</button>
        </div>
    </div>
    
    <!-- é€šçŸ¥æ¶ˆæ¯ -->
    <div class="notification" id="notification"></div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        const game = {
            score: 0,
            coins: 0,
            level: 1,
            playerHealth: 100,
            maxHealth: 100,
            baseFireRate: 3.0,
            fireRateMultiplier: 1,
            damage: 15,
            isGameOver: false,
            playerX: 50,
            enemies: [],
            bullets: [],
            explosions: [],
            floatingTexts: [],
            stars: [],
            enemySpawnRate: 1500,
            lastEnemySpawn: 0,
            lastFireTime: 0,
            touchX: null,
            keys: {
                left: false,
                right: false
            },
            playerSpeed: 5,
            bossActive: false,
            bossHealth: 0,
            maxBossHealth: 0,
            bossMoveDirection: 1,
            bossMoveSpeed: 2,
            unlockedLevels: 1, // åˆå§‹è§£é–ç¬¬1é—œ
            currentLevel: 1,
            selectedClass: 'fighter', // é»˜èªè·æ¥­
            unlockedClasses: ['fighter', 'sniper', 'tank', 'assault'], // åˆå§‹è§£é–è·æ¥­
            selectedSkin: 'default', // é»˜èªçš®è†š
            unlockedSkins: ['default'], // å·²è§£é–çš®è†š
            lootBoxType: 'common', // ç•¶å‰æŠ½çç®±é¡å‹
            classStats: {
                fighter: { name: 'æˆ°é¬¥æ©Ÿ', emoji: 'ğŸš€', fireRate: 1.0, damage: 1.0, health: 1.0 },
                sniper: { name: 'ç‹™æ“Šæ‰‹', emoji: 'ğŸ”­', fireRate: 0.6, damage: 1.8, health: 0.8 },
                tank: { name: 'å¦å…‹', emoji: 'ğŸ›¡ï¸', fireRate: 0.7, damage: 0.8, health: 1.5 },
                assault: { name: 'çªæ“Šå…µ', emoji: 'ğŸ’¥', fireRate: 1.5, damage: 0.7, health: 0.8 },
                ninja: { name: 'å¿è€…', emoji: 'ğŸ¥·', fireRate: 1.2, damage: 1.2, health: 1.0 },
                wizard: { name: 'å·«å¸«', emoji: 'ğŸ§™', fireRate: 1.0, damage: 1.3, health: 1.2 }
            },
            skinEmojis: {
                default: 'ğŸš€',
                ufo: 'ğŸ›¸',
                rocket: 'ğŸš€',
                dragon: 'ğŸ‰',
                alien: 'ğŸ‘½',
                ghost: 'ğŸ‘»'
            },
            lootBoxItems: {
                common: [
                    { type: 'coin', value: 100, emoji: 'ğŸª™', probability: 0.5 },
                    { type: 'coin', value: 200, emoji: 'ğŸ’°', probability: 0.3 },
                    { type: 'skin', value: 'ufo', emoji: 'ğŸ›¸', probability: 0.15 },
                    { type: 'skin', value: 'rocket', emoji: 'ğŸš€', probability: 0.05 }
                ],
                rare: [
                    { type: 'coin', value: 300, emoji: 'ğŸª™', probability: 0.4 },
                    { type: 'coin', value: 500, emoji: 'ğŸ’°', probability: 0.3 },
                    { type: 'skin', value: 'ufo', emoji: 'ğŸ›¸', probability: 0.15 },
                    { type: 'skin', value: 'rocket', emoji: 'ğŸš€', probability: 0.1 },
                    { type: 'skin', value: 'dragon', emoji: 'ğŸ‰', probability: 0.05 }
                ],
                legendary: [
                    { type: 'coin', value: 800, emoji: 'ğŸª™', probability: 0.3 },
                    { type: 'coin', value: 1000, emoji: 'ğŸ’°', probability: 0.2 },
                    { type: 'skin', value: 'ufo', emoji: 'ğŸ›¸', probability: 0.15 },
                    { type: 'skin', value: 'rocket', emoji: 'ğŸš€', probability: 0.15 },
                    { type: 'skin', value: 'dragon', emoji: 'ğŸ‰', probability: 0.1 },
                    { type: 'skin', value: 'alien', emoji: 'ğŸ‘½', probability: 0.05 },
                    { type: 'skin', value: 'ghost', emoji: 'ğŸ‘»', probability: 0.05 }
                ]
            },
            lootBoxPrices: {
                common: 500,
                rare: 1000,
                legendary: 2000
            },
            skinPrices: {
                ufo: 1000,
                rocket: 1500,
                dragon: 0, // é€šéé—œå¡è§£é–
                alien: 0, // é€šéé—œå¡è§£é–
                ghost: 0  // é€šéBOSSè§£é–
            }
        };
        
        // DOMå…ƒç´ 
        const mainMenu = document.getElementById('main-menu');
        const playBtn = document.getElementById('play-btn');
        const shopBtn = document.getElementById('shop-btn');
        const exitBtn = document.getElementById('exit-btn');
        const classSelect = document.getElementById('class-select');
        const classContainer = document.getElementById('class-container');
        const levelSelect = document.getElementById('level-select');
        const levelContainer = document.getElementById('level-container');
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const fireRateDisplay = document.getElementById('fire-rate');
        const damageDisplay = document.getElementById('damage');
        const coinsDisplay = document.getElementById('coins');
        const healthFill = document.getElementById('health-fill');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalLevelDisplay = document.getElementById('final-level');
        const coinsEarnedDisplay = document.getElementById('coins-earned');
        const restartBtn = document.getElementById('restart-btn');
        const levelCompleteScreen = document.getElementById('level-complete');
        const completeScoreDisplay = document.getElementById('complete-score');
        const nextLevelDisplay = document.getElementById('next-level');
        const coinsRewardDisplay = document.getElementById('coins-reward');
        const continueBtn = document.getElementById('continue-btn');
        const bossHealthBar = document.getElementById('boss-health-bar');
        const bossHealthFill = document.getElementById('boss-health-fill');
        const backToMenuFromClassBtn = document.getElementById('back-to-menu-from-class');
        const backToMenuFromLevelBtn = document.getElementById('back-to-menu-from-level');
        const shopScreen = document.getElementById('shop');
        const skinsTab = document.getElementById('skins-tab');
        const lootBoxTab = document.getElementById('loot-box-tab');
        const shopTabButtons = document.querySelectorAll('.shop-tab-btn');
        const backToMenuFromShopBtn = document.getElementById('back-to-menu-from-shop');
        const lootBoxScreen = document.getElementById('loot-box');
        const lootBoxTitle = document.querySelector('.loot-box-title');
        const lootBoxCost = document.querySelector('.loot-box-cost span');
        const lootBoxPreview = document.querySelector('.loot-box-preview');
        const lootBoxResult = document.querySelector('.loot-box-result');
        const buyLootBoxBtn = document.getElementById('buy-loot-box');
        const closeLootBoxBtn = document.getElementById('close-loot-box');
        const notification = document.getElementById('notification');
        
        // é¡¯ç¤ºé€šçŸ¥æ¶ˆæ¯
        function showNotification(message, duration = 2000) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        // åˆå§‹åŒ–è·æ¥­é¸æ“‡
        function initClassSelect() {
            const classCards = classContainer.querySelectorAll('.class-card');
            
            classCards.forEach(card => {
                const classType = card.getAttribute('data-class');
                
                if (game.unlockedClasses.includes(classType)) {
                    card.classList.remove('locked');
                    card.style.cursor = 'pointer';
                } else {
                    card.classList.add('locked');
                    card.style.cursor = 'not-allowed';
                }
                
                if (game.selectedClass === classType) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }
        
        // åˆå§‹åŒ–é—œå¡é¸æ“‡
        function initLevelSelect() {
            const levelButtons = levelContainer.querySelectorAll('.level-btn');
            
            levelButtons.forEach(button => {
                const level = parseInt(button.getAttribute('data-level')) || 0;
                
                if (level <= game.unlockedLevels) {
                    button.classList.remove('locked');
                    button.style.cursor = 'pointer';
                } else {
                    button.classList.add('locked');
                    button.style.cursor = 'not-allowed';
                }
            });
        }
        
        // åˆå§‹åŒ–å•†åº—
        function initShop() {
            // åˆå§‹åŒ–çš®è†šé¸é …å¡
            const skinCards = skinsTab.querySelectorAll('.skin-card');
            
            skinCards.forEach(card => {
                const skin = card.getAttribute('data-skin');
                
                if (game.unlockedSkins.includes(skin)) {
                    card.classList.remove('locked');
                    card.style.cursor = 'pointer';
                    card.querySelector('.skin-price').textContent = 'å·²æ“æœ‰';
                } else if (skin === 'dragon' && game.unlockedLevels >= 3) {
                    card.classList.remove('locked');
                    card.style.cursor = 'pointer';
                    card.querySelector('.skin-price').textContent = 'å¯è§£é–';
                } else if (skin === 'alien' && game.unlockedLevels >= 5) {
                    card.classList.remove('locked');
                    card.style.cursor = 'pointer';
                    card.querySelector('.skin-price').textContent = 'å¯è§£é–';
                } else if (skin === 'ghost' && game.unlockedLevels >= 6) {
                    card.classList.remove('locked');
                    card.style.cursor = 'pointer';
                    card.querySelector('.skin-price').textContent = 'å¯è§£é–';
                } else {
                    card.classList.add('locked');
                    card.style.cursor = 'not-allowed';
                }
                
                if (game.selectedSkin === skin) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // åˆå§‹åŒ–æŠ½çç®±é¸é …å¡
            const lootBoxCards = lootBoxTab.querySelectorAll('.skin-card');
            
            lootBoxCards.forEach(card => {
                const lootType = card.getAttribute('data-loot');
                const price = game.lootBoxPrices[lootType];
                card.querySelector('.skin-price span').textContent = price;
            });
        }
        
        // æ›´æ–°HUD
        function updateHUD() {
            scoreDisplay.textContent = game.score;
            levelDisplay.textContent = game.currentLevel;
            fireRateDisplay.textContent = (game.baseFireRate * game.fireRateMultiplier).toFixed(1);
            damageDisplay.textContent = game.damage;
            coinsDisplay.textContent = game.coins;
            healthFill.style.width = `${(game.playerHealth / game.maxHealth) * 100}%`;
            
            if (game.bossActive) {
                bossHealthFill.style.width = `${(game.bossHealth / game.maxBossHealth) * 100}%`;
            }
        }
        
        // éŠæˆ²åˆå§‹åŒ–
        function initGame() {
            // æ ¹æ“šé¸æ“‡çš„è·æ¥­è¨­ç½®å±¬æ€§
            const classStats = game.classStats[game.selectedClass];
            game.baseFireRate = 3.0 * classStats.fireRate;
            game.damage = 15 * classStats.damage;
            game.maxHealth = 100 * classStats.health;
            game.playerHealth = game.maxHealth;
            
            game.score = 0;
            game.isGameOver = false;
            game.playerX = 50;
            game.enemies = [];
            game.bullets = [];
            game.explosions = [];
            game.floatingTexts = [];
            game.bossActive = false;
            
            // è¨­ç½®ç©å®¶çš®è†š
            player.textContent = game.skinEmojis[game.selectedSkin];
            
            updateHUD();
            gameOverScreen.style.display = 'none';
            levelCompleteScreen.style.display = 'none';
            bossHealthBar.style.display = 'none';
            
            // æ¸…é™¤æ‰€æœ‰éŠæˆ²å…ƒç´ 
            document.querySelectorAll('.enemy, .bullet, .explosion, .floating-text').forEach(el => {
                if (el.parentNode) el.parentNode.removeChild(el);
            });
            
            // é‡ç½®ç©å®¶ä½ç½®
            updatePlayerPosition();
        }
        
        // æ›´æ–°ç©å®¶ä½ç½®
        function updatePlayerPosition() {
            const containerWidth = gameContainer.clientWidth;
            const playerWidth = player.clientWidth;
            const maxX = containerWidth - playerWidth;
            
            let x = (game.playerX / 100) * containerWidth;
            x = Math.max(0, Math.min(maxX, x));
            player.style.left = `${x}px`;
        }
        
        // è™•ç†éµç›¤è¼¸å…¥
        function handleKeyboard() {
            if (game.keys.left) {
                game.playerX -= game.playerSpeed;
            }
            if (game.keys.right) {
                game.playerX += game.playerSpeed;
            }
            game.playerX = Math.max(0, Math.min(100, game.playerX));
            updatePlayerPosition();
        }
        
        // ç”Ÿæˆæ•µäºº
        function spawnEnemy() {
            // BOSSé—œå¡ç‰¹æ®Šè™•ç†
            if (game.currentLevel === 'boss' && !game.bossActive && game.enemies.length === 0) {
                spawnBoss();
                return;
            }
            
            const enemyTypes = [
                { type: 'normal', emoji: 'ğŸ‘¾', speed: 2, health: 20 },
                { type: 'fast', emoji: 'ğŸ‘½', speed: 4, health: 15 },
                { type: 'tank', emoji: 'ğŸ¤–', speed: 1.5, health: 40 }
            ];
            
            // æ ¹æ“šé—œå¡èª¿æ•´é›£åº¦
            let typeWeights;
            if (game.currentLevel <= 2) {
                typeWeights = [0.6, 0.3, 0.1]; // ç°¡å–®é—œå¡å¤šæ™®é€šæ•µäºº
            } else if (game.currentLevel <= 4) {
                typeWeights = [0.4, 0.4, 0.2]; // ä¸­ç­‰é—œå¡å¹³è¡¡
            } else {
                typeWeights = [0.2, 0.3, 0.5]; // å›°é›£é—œå¡å¤šå¦å…‹æ•µäºº
            }
            
            // æ ¹æ“šæ¬Šé‡éš¨æ©Ÿé¸æ“‡æ•µäººé¡å‹
            const rand = Math.random();
            let selectedType;
            if (rand < typeWeights[0]) {
                selectedType = enemyTypes[0];
            } else if (rand < typeWeights[0] + typeWeights[1]) {
                selectedType = enemyTypes[1];
            } else {
                selectedType = enemyTypes[2];
            }
            
            const enemy = document.createElement('div');
            enemy.className = `enemy ${selectedType.type}`;
            enemy.textContent = selectedType.emoji;
            
            const containerWidth = gameContainer.clientWidth;
            const x = Math.random() * (containerWidth - 50);
            
            enemy.style.left = `${x}px`;
            enemy.style.top = '-50px';
            gameContainer.appendChild(enemy);
            
            // æ ¹æ“šé—œå¡èª¿æ•´æ•µäººå±¬æ€§
            const healthMultiplier = 1 + (game.currentLevel * 0.2);
            const speedMultiplier = 1 + (game.currentLevel * 0.05);
            
            game.enemies.push({
                element: enemy,
                x: x,
                y: -50,
                speed: selectedType.speed * speedMultiplier,
                health: selectedType.health * healthMultiplier,
                maxHealth: selectedType.health * healthMultiplier,
                type: selectedType.type,
                emoji: selectedType.emoji,
                id: Date.now() + Math.random()
            });
        }
        
        // ç”ŸæˆBOSS
        function spawnBoss() {
            game.bossActive = true;
            const bossEmojis = ['ğŸ‘¹', 'ğŸ‘»', 'ğŸ‰'];
            const selectedEmoji = bossEmojis[Math.floor(Math.random() * bossEmojis.length)];
            
            const boss = document.createElement('div');
            boss.className = 'enemy boss';
            boss.textContent = selectedEmoji;
            
            const containerWidth = gameContainer.clientWidth;
            const x = containerWidth / 2 - 50;
            
            boss.style.left = `${x}px`;
            boss.style.top = '-100px';
            gameContainer.appendChild(boss);
            
            game.maxBossHealth = 200 + (game.unlockedLevels * 50);
            game.bossHealth = game.maxBossHealth;
            
            bossHealthBar.style.display = 'block';
            updateHUD();
            
            game.enemies.push({
                element: boss,
                x: x,
                y: -100,
                speed: 2,
                health: game.maxBossHealth,
                maxHealth: game.maxBossHealth,
                type: 'boss',
                emoji: selectedEmoji,
                id: Date.now() + Math.random(),
                isBoss: true
            });
            
            createFloatingText(`BOSS å‡ºç¾!`, containerWidth / 2, 100, 0, '#e74c3c');
        }
        
        // ç©å®¶å°„æ“Š
        function fireBullet() {
            const now = Date.now();
            const actualFireRate = game.baseFireRate * game.fireRateMultiplier;
            
            if (now - game.lastFireTime < 1000 / actualFireRate) return;
            game.lastFireTime = now;
            
            const playerRect = player.getBoundingClientRect();
            const centerX = playerRect.left + playerRect.width / 2;
            const centerY = playerRect.top;
            
            // æ ¹æ“šè·æ¥­ç™¼å°„ä¸åŒçš„å­å½ˆ
            if (game.selectedClass === 'sniper') {
                createSniperBullet(centerX, centerY);
            } else if (game.selectedClass === 'assault') {
                createAssaultBullets(centerX, centerY);
            } else if (game.selectedClass === 'ninja') {
                createNinjaBullets(centerX, centerY);
            } else if (game.selectedClass === 'wizard') {
                createWizardBullets(centerX, centerY);
            } else {
                createBullet(centerX, centerY);
            }
        }
        
        // å‰µå»ºæ™®é€šå­å½ˆ
        function createBullet(x, y) {
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            
            bullet.style.left = `${x - 3}px`;
            bullet.style.top = `${y}px`;
            gameContainer.appendChild(bullet);
            
            game.bullets.push({
                element: bullet,
                x: x,
                y: y,
                speed: 8 + (game.currentLevel * 0.5), // éš¨é—œå¡å¢åŠ å­å½ˆé€Ÿåº¦
                damage: game.damage,
                id: Date.now() + Math.random()
            });
        }
        
        // å‰µå»ºç‹™æ“Šæ‰‹å­å½ˆ
        function createSniperBullet(x, y) {
            const bullet = document.createElement('div');
            bullet.className = 'special-bullet';
            bullet.style.background = 'linear-gradient(to bottom, #3498db, #2980b9)';
            bullet.style.color = '#3498db';
            
            bullet.style.left = `${x - 5}px`;
            bullet.style.top = `${y}px`;
            gameContainer.appendChild(bullet);
            
            game.bullets.push({
                element: bullet,
                x: x,
                y: y,
                speed: 12,
                damage: game.damage * 1.5,
                id: Date.now() + Math.random()
            });
        }
        
        // å‰µå»ºçªæ“Šå…µå­å½ˆ
        function createAssaultBullets(x, y) {
            // ä¸»å­å½ˆ
            createBullet(x, y);
            
            // å…©å´å­å½ˆ
            setTimeout(() => {
                createBullet(x - 15, y);
                createBullet(x + 15, y);
            }, 50);
        }
        
        // å‰µå»ºå¿è€…å­å½ˆ
        function createNinjaBullets(x, y) {
            // ä¸»å­å½ˆ
            const bullet1 = document.createElement('div');
            bullet1.className = 'special-bullet';
            bullet1.style.background = 'linear-gradient(to bottom, #2c3e50, #34495e)';
            bullet1.style.color = '#2c3e50';
            bullet1.style.left = `${x - 5}px`;
            bullet1.style.top = `${y}px`;
            gameContainer.appendChild(bullet1);
            
            game.bullets.push({
                element: bullet1,
                x: x,
                y: y,
                speed: 10,
                damage: game.damage,
                id: Date.now() + Math.random()
            });
            
            // å…©å´å­å½ˆ
            setTimeout(() => {
                const bullet2 = document.createElement('div');
                bullet2.className = 'special-bullet';
                bullet2.style.background = 'linear-gradient(to bottom, #2c3e50, #34495e)';
                bullet2.style.color = '#2c3e50';
                bullet2.style.left = `${x - 20}px`;
                bullet2.style.top = `${y}px`;
                gameContainer.appendChild(bullet2);
                
                game.bullets.push({
                    element: bullet2,
                    x: x - 15,
                    y: y,
                    speed: 10,
                    damage: game.damage * 0.8,
                    id: Date.now() + Math.random() + 1
                });
                
                const bullet3 = document.createElement('div');
                bullet3.className = 'special-bullet';
                bullet3.style.background = 'linear-gradient(to bottom, #2c3e50, #34495e)';
                bullet3.style.color = '#2c3e50';
                bullet3.style.left = `${x + 10}px`;
                bullet3.style.top = `${y}px`;
                gameContainer.appendChild(bullet3);
                
                game.bullets.push({
                    element: bullet3,
                    x: x + 15,
                    y: y,
                    speed: 10,
                    damage: game.damage * 0.8,
                    id: Date.now() + Math.random() + 2
                });
            }, 50);
        }
        
        // å‰µå»ºå·«å¸«å­å½ˆ
        function createWizardBullets(x, y) {
            // ä¸»å­å½ˆ
            const bullet1 = document.createElement('div');
            bullet1.className = 'special-bullet';
            bullet1.style.background = 'linear-gradient(to bottom, #9b59b6, #8e44ad)';
            bullet1.style.color = '#9b59b6';
            bullet1.style.left = `${x - 5}px`;
            bullet1.style.top = `${y}px`;
            gameContainer.appendChild(bullet1);
            
            game.bullets.push({
                element: bullet1,
                x: x,
                y: y,
                speed: 8,
                damage: game.damage * 1.2,
                id: Date.now() + Math.random()
            });
            
            // è¿½è¹¤å­å½ˆ
            setTimeout(() => {
                if (game.enemies.length > 0) {
                    const targetEnemy = game.enemies[Math.floor(Math.random() * game.enemies.length)];
                    const targetX = targetEnemy.x + targetEnemy.element.clientWidth / 2;
                    const targetY = targetEnemy.y + targetEnemy.element.clientHeight / 2;
                    
                    const bullet2 = document.createElement('div');
                    bullet2.className = 'special-bullet';
                    bullet2.style.background = 'linear-gradient(to bottom, #9b59b6, #8e44ad)';
                    bullet2.style.color = '#9b59b6';
                    bullet2.style.left = `${x - 5}px`;
                    bullet2.style.top = `${y}px`;
                    gameContainer.appendChild(bullet2);
                    
                    game.bullets.push({
                        element: bullet2,
                        x: x,
                        y: y,
                        speed: 6,
                        damage: game.damage * 0.8,
                        id: Date.now() + Math.random() + 1,
                        isHoming: true,
                        targetX: targetX,
                        targetY: targetY
                    });
                }
            }, 100);
        }
        
        // å‰µå»ºçˆ†ç‚¸æ•ˆæœ
        function createExplosion(x, y) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = `${x - 25}px`;
            explosion.style.top = `${y - 25}px`;
            gameContainer.appendChild(explosion);
            
            game.explosions.push({
                element: explosion,
                time: Date.now(),
                id: Date.now() + Math.random()
            });
        }
        
        // å‰µå»ºæµ®å‹•æ–‡å­—
        function createFloatingText(text, x, y, color = '#f1c40f') {
            const floatingText = document.createElement('div');
            floatingText.className = 'floating-text';
            floatingText.textContent = text;
            floatingText.style.left = `${x}px`;
            floatingText.style.top = `${y}px`;
            floatingText.style.color = color;
            gameContainer.appendChild(floatingText);
            
            game.floatingTexts.push({
                element: floatingText,
                time: Date.now(),
                id: Date.now() + Math.random()
            });
        }
        
        // é—œå¡å®Œæˆ
        function completeLevel() {
            // è¨ˆç®—ç²å¾—çš„é‡‘å¹£
            let coinsEarned = game.currentLevel * 50;
            if (game.currentLevel === 'boss') coinsEarned = 200;
            
            game.coins += coinsEarned;
            coinsRewardDisplay.textContent = `+${coinsEarned}`;
            
            // è§£é–ä¸‹ä¸€é—œ
            if (game.currentLevel === 'boss') {
                game.unlockedLevels = Math.max(game.unlockedLevels, 6); // BOSSé—œæ˜¯ç¬¬6é—œ
                
                // è§£é–å¹½éˆçš®è†š
                if (!game.unlockedSkins.includes('ghost')) {
                    game.unlockedSkins.push('ghost');
                    showNotification('è§£é–æ–°çš®è†š: å¹½éˆé£›èˆ¹!');
                }
                
                // è§£é–å·«å¸«è·æ¥­
                if (!game.unlockedClasses.includes('wizard')) {
                    game.unlockedClasses.push('wizard');
                    showNotification('è§£é–æ–°è·æ¥­: å·«å¸«!');
                }
            } else {
                game.unlockedLevels = Math.max(game.unlockedLevels, game.currentLevel + 1);
                
                // è§£é–é¾çš®è†š
                if (game.currentLevel === 3 && !game.unlockedSkins.includes('dragon')) {
                    game.unlockedSkins.push('dragon');
                    showNotification('è§£é–æ–°çš®è†š: é¾é£›èˆ¹!');
                }
                
                // è§£é–å¤–æ˜Ÿäººçš®è†š
                if (game.currentLevel === 5 && !game.unlockedSkins.includes('alien')) {
                    game.unlockedSkins.push('alien');
                    showNotification('è§£é–æ–°çš®è†š: å¤–æ˜Ÿäºº!');
                }
                
                // è§£é–å¿è€…è·æ¥­
                if (game.currentLevel === 4 && !game.unlockedClasses.includes('ninja')) {
                    game.unlockedClasses.push('ninja');
                    showNotification('è§£é–æ–°è·æ¥­: å¿è€…!');
                }
            }
            
            // é¡¯ç¤ºé—œå¡å®Œæˆç•«é¢
            levelCompleteScreen.style.display = 'flex';
            completeScoreDisplay.textContent = game.score;
            
            if (game.currentLevel === 'boss') {
                nextLevelDisplay.textContent = 'å…¨éƒ¨å®Œæˆ!';
            } else if (game.currentLevel === 5) {
                nextLevelDisplay.textContent = 'BOSS';
            } else {
                nextLevelDisplay.textContent = game.currentLevel + 1;
            }
            
            // ä¿å­˜é€²åº¦åˆ°æœ¬åœ°å­˜å„²
            saveProgress();
        }
        
        // éŠæˆ²çµæŸ
        function gameOver() {
            game.isGameOver = true;
            finalScoreDisplay.textContent = game.score;
            finalLevelDisplay.textContent = game.currentLevel;
            
            // è¨ˆç®—ç²å¾—çš„é‡‘å¹£ (åˆ†æ•¸çš„10%)
            const coinsEarned = Math.floor(game.score / 10);
            game.coins += coinsEarned;
            coinsEarnedDisplay.textContent = `+${coinsEarned}`;
            
            gameOverScreen.style.display = 'flex';
            
            // ä¿å­˜é€²åº¦åˆ°æœ¬åœ°å­˜å„²
            saveProgress();
        }
        
        // ä¿å­˜éŠæˆ²é€²åº¦
        function saveProgress() {
            localStorage.setItem('unlockedLevels', game.unlockedLevels);
            localStorage.setItem('coins', game.coins);
            localStorage.setItem('selectedClass', game.selectedClass);
            localStorage.setItem('unlockedClasses', JSON.stringify(game.unlockedClasses));
            localStorage.setItem('selectedSkin', game.selectedSkin);
            localStorage.setItem('unlockedSkins', JSON.stringify(game.unlockedSkins));
        }
        
        // åŠ è¼‰éŠæˆ²é€²åº¦
        function loadProgress() {
            const savedLevels = localStorage.getItem('unlockedLevels');
            if (savedLevels) game.unlockedLevels = parseInt(savedLevels);
            
            const savedCoins = localStorage.getItem('coins');
            if (savedCoins) game.coins = parseInt(savedCoins);
            
            const savedClass = localStorage.getItem('selectedClass');
            if (savedClass) game.selectedClass = savedClass;
            
            const savedUnlockedClasses = localStorage.getItem('unlockedClasses');
            if (savedUnlockedClasses) game.unlockedClasses = JSON.parse(savedUnlockedClasses);
            
            const savedSkin = localStorage.getItem('selectedSkin');
            if (savedSkin) game.selectedSkin = savedSkin;
            
            const savedUnlockedSkins = localStorage.getItem('unlockedSkins');
            if (savedUnlockedSkins) game.unlockedSkins = JSON.parse(savedUnlockedSkins);
        }
        
        // éŠæˆ²ä¸»å¾ªç’°
        function gameLoop(timestamp) {
            if (game.isGameOver) return;
            
            // è™•ç†éµç›¤è¼¸å…¥
            handleKeyboard();
            
            // è‡ªå‹•å°„æ“Š
            fireBullet();
            
            // ç”Ÿæˆæ•µäºº
            if (timestamp - game.lastEnemySpawn > game.enemySpawnRate) {
                spawnEnemy();
                game.lastEnemySpawn = timestamp;
                
                // æ ¹æ“šé—œå¡èª¿æ•´ç”Ÿæˆç‡
                if (game.currentLevel === 'boss') {
                    game.enemySpawnRate = 3000;
                } else {
                    game.enemySpawnRate = Math.max(500, 2000 - (game.currentLevel * 200));
                }
            }
            
            // æ›´æ–°æ•µäººä½ç½®
            for (let i = game.enemies.length - 1; i >= 0; i--) {
                const enemy = game.enemies[i];
                
                // BOSSç‰¹æ®Šç§»å‹•æ¨¡å¼
                if (enemy.isBoss) {
                    enemy.x += game.bossMoveDirection * game.bossMoveSpeed;
                    
                    // BOSSå·¦å³ç§»å‹•
                    if (enemy.x <= 0 || enemy.x >= gameContainer.clientWidth - 100) {
                        game.bossMoveDirection *= -1;
                    }
                    
                    // BOSSå¶çˆ¾å‘ä¸‹ç§»å‹•
                    if (Math.random() < 0.01 && enemy.y < gameContainer.clientHeight * 0.3) {
                        enemy.y += 20;
                    }
                } else {
                    // æ™®é€šæ•µäººç›´ç·šå‘ä¸‹
                    enemy.y += enemy.speed;
                }
                
                enemy.element.style.left = `${enemy.x}px`;
                enemy.element.style.top = `${enemy.y}px`;
                
                // æª¢æŸ¥æ•µäººæ˜¯å¦è¶…å‡ºå±å¹•åº•éƒ¨
                if (enemy.y > gameContainer.clientHeight) {
                    if (enemy.element.parentNode) {
                        enemy.element.parentNode.removeChild(enemy.element);
                    }
                    game.enemies.splice(i, 1);
                    
                    if (enemy.isBoss) {
                        game.bossActive = false;
                        bossHealthBar.style.display = 'none';
                    }
                    continue;
                }
                
                // æª¢æŸ¥æ•µäººèˆ‡ç©å®¶ç¢°æ’
                const playerRect = player.getBoundingClientRect();
                const enemyRect = enemy.element.getBoundingClientRect();
                
                if (!(
                    playerRect.right < enemyRect.left || 
                    playerRect.left > enemyRect.right || 
                    playerRect.bottom < enemyRect.top || 
                    playerRect.top > enemyRect.bottom
                )) {
                    // ç©å®¶è¢«æ“Šä¸­
                    const damage = enemy.isBoss ? 20 : 10;
                    game.playerHealth -= damage;
                    updateHUD();
                    
                    createExplosion(enemyRect.left + enemyRect.width / 2, enemyRect.top + enemyRect.height / 2);
                    createFloatingText(`-${damage}`, playerRect.left + playerRect.width / 2, playerRect.top, '#e74c3c');
                    
                    if (!enemy.isBoss) {
                        if (enemy.element.parentNode) {
                            enemy.element.parentNode.removeChild(enemy.element);
                        }
                        game.enemies.splice(i, 1);
                    }
                    
                    if (game.playerHealth <= 0) {
                        gameOver();
                    }
                }
            }
            
            // æ›´æ–°å­å½ˆä½ç½®
            for (let i = game.bullets.length - 1; i >= 0; i--) {
                const bullet = game.bullets[i];
                
                // è¿½è¹¤å­å½ˆé‚è¼¯
                if (bullet.isHoming && game.enemies.length > 0) {
                    const dx = bullet.targetX - bullet.x;
                    const dy = bullet.targetY - bullet.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 10) {
                        bullet.x += (dx / distance) * bullet.speed;
                        bullet.y += (dy / distance) * bullet.speed;
                    }
                } else {
                    // æ™®é€šå­å½ˆç›´ç·šå‘ä¸Šç§»å‹•
                    bullet.y -= bullet.speed;
                }
                
                bullet.element.style.left = `${bullet.x - (bullet.element.clientWidth / 2)}px`;
                bullet.element.style.top = `${bullet.y}px`;
                
                // æª¢æŸ¥å­å½ˆæ˜¯å¦è¶…å‡ºå±å¹•
                if (bullet.y < -15) {
                    if (bullet.element.parentNode) {
                        bullet.element.parentNode.removeChild(bullet.element);
                    }
                    game.bullets.splice(i, 1);
                    continue;
                }
                
                // æª¢æŸ¥å­å½ˆèˆ‡æ•µäººç¢°æ’
                for (let j = game.enemies.length - 1; j >= 0; j--) {
                    const enemy = game.enemies[j];
                    
                    const bulletRect = bullet.element.getBoundingClientRect();
                    const enemyRect = enemy.element.getBoundingClientRect();
                    
                    if (!(
                        bulletRect.right < enemyRect.left || 
                        bulletRect.left > enemyRect.right || 
                        bulletRect.bottom < enemyRect.top || 
                        bulletRect.top > enemyRect.bottom
                    )) {
                        // æ“Šä¸­æ•µäºº
                        enemy.health -= bullet.damage;
                        
                        if (enemy.health <= 0) {
                            createExplosion(enemyRect.left + enemyRect.width / 2, enemyRect.top + enemyRect.height / 2);
                            const points = enemy.isBoss ? 100 : 10 * game.currentLevel;
                            createFloatingText(`+${points}`, enemyRect.left + enemyRect.width / 2, enemyRect.top, '#2ecc71');
                            
                            if (enemy.element.parentNode) {
                                enemy.element.parentNode.removeChild(enemy.element);
                            }
                            game.enemies.splice(j, 1);
                            game.score += points;
                            
                            if (enemy.isBoss) {
                                game.bossActive = false;
                                bossHealthBar.style.display = 'none';
                                createFloatingText('BOSS æ“Šæ•—!', gameContainer.clientWidth / 2, 100, '#f39c12');
                                completeLevel();
                            }
                        } else {
                            createFloatingText(`-${bullet.damage}`, enemyRect.left + enemyRect.width / 2, enemyRect.top);
                            
                            if (enemy.isBoss) {
                                game.bossHealth = enemy.health;
                                updateHUD();
                            }
                        }
                        
                        if (bullet.element.parentNode) {
                            bullet.element.parentNode.removeChild(bullet.element);
                        }
                        game.bullets.splice(i, 1);
                        updateHUD();
                        break;
                    }
                }
            }
            
            // æª¢æŸ¥æ™®é€šé—œå¡å®Œæˆæ¢ä»¶ï¼ˆæ“Šæ•—ä¸€å®šæ•¸é‡æ•µäººï¼‰
            if (typeof game.currentLevel === 'number' && !game.bossActive && 
                game.score >= game.currentLevel * 50 && game.enemies.length === 0) {
                completeLevel();
            }
            
            // æ›´æ–°çˆ†ç‚¸æ•ˆæœ
            for (let i = game.explosions.length - 1; i >= 0; i--) {
                if (Date.now() - game.explosions[i].time > 500) {
                    if (game.explosions[i].element.parentNode) {
                        game.explosions[i].element.parentNode.removeChild(game.explosions[i].element);
                    }
                    game.explosions.splice(i, 1);
                }
            }
            
            // æ›´æ–°æµ®å‹•æ–‡å­—
            for (let i = game.floatingTexts.length - 1; i >= 0; i--) {
                if (Date.now() - game.floatingTexts[i].time > 1000) {
                    if (game.floatingTexts[i].element.parentNode) {
                        game.floatingTexts[i].element.parentNode.removeChild(game.floatingTexts[i].element);
                    }
                    game.floatingTexts.splice(i, 1);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // é–‹å§‹éŠæˆ²
        function startGame(level) {
            game.currentLevel = level === 'boss' ? 'boss' : parseInt(level);
            levelSelect.style.display = 'none';
            gameContainer.style.display = 'block';
            
            // æ ¹æ“šé¸æ“‡çš„é—œå¡è¨­ç½®éŠæˆ²é›£åº¦
            if (level === 'boss') {
                game.enemySpawnRate = 3000;
            } else {
                game.enemySpawnRate = 2000 - (game.currentLevel * 200);
            }
            
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            initGame();
            requestAnimationFrame(gameLoop);
        }
        
        // è³¼è²·çš®è†š
        function buySkin(skin) {
            if (game.unlockedSkins.includes(skin)) {
                // å·²ç¶“æ“æœ‰ï¼Œç›´æ¥é¸æ“‡
                game.selectedSkin = skin;
                showNotification(`å·²é¸æ“‡çš®è†š: ${skin}`);
            } else if (skin === 'dragon' && game.unlockedLevels >= 3) {
                // è§£é–é¾çš®è†š
                game.unlockedSkins.push(skin);
                game.selectedSkin = skin;
                showNotification(`è§£é–æ–°çš®è†š: é¾é£›èˆ¹!`);
            } else if (skin === 'alien' && game.unlockedLevels >= 5) {
                // è§£é–å¤–æ˜Ÿäººçš®è†š
                game.unlockedSkins.push(skin);
                game.selectedSkin = skin;
                showNotification(`è§£é–æ–°çš®è†š: å¤–æ˜Ÿäºº!`);
            } else if (skin === 'ghost' && game.unlockedLevels >= 6) {
                // è§£é–å¹½éˆçš®è†š
                game.unlockedSkins.push(skin);
                game.selectedSkin = skin;
                showNotification(`è§£é–æ–°çš®è†š: å¹½éˆé£›èˆ¹!`);
            } else {
                // éœ€è¦è³¼è²·
                const price = game.skinPrices[skin];
                if (game.coins >= price) {
                    game.coins -= price;
                    game.unlockedSkins.push(skin);
                    game.selectedSkin = skin;
                    showNotification(`è³¼è²·æˆåŠŸ! å·²è§£é–çš®è†š: ${skin}`);
                    updateHUD();
                } else {
                    showNotification(`é‡‘å¹£ä¸è¶³! éœ€è¦ ${price} é‡‘å¹£`, 3000);
                }
            }
            
            // æ›´æ–°å•†åº—é¡¯ç¤º
            initShop();
            saveProgress();
        }
        
        // æ‰“é–‹æŠ½çç®±
        function openLootBox(type) {
            game.lootBoxType = type;
            lootBoxTitle.textContent = `${type === 'common' ? 'æ™®é€š' : type === 'rare' ? 'ç¨€æœ‰' : 'å‚³èªª'}æŠ½çç®±`;
            lootBoxCost.textContent = game.lootBoxPrices[type];
            lootBoxResult.classList.remove('show');
            lootBoxScreen.style.display = 'flex';
        }
        
        // è³¼è²·æŠ½çç®±
        function buyLootBox() {
            const price = game.lootBoxPrices[game.lootBoxType];
            
            if (game.coins >= price) {
                game.coins -= price;
                updateHUD();
                
                // æŠ½çé‚è¼¯
                const items = game.lootBoxItems[game.lootBoxType];
                const totalProbability = items.reduce((sum, item) => sum + item.probability, 0);
                let random = Math.random() * totalProbability;
                let selectedItem = null;
                
                for (const item of items) {
                    if (random < item.probability) {
                        selectedItem = item;
                        break;
                    }
                    random -= item.probability;
                }
                
                // é¡¯ç¤ºçµæœ
                lootBoxResult.textContent = selectedItem.emoji;
                setTimeout(() => {
                    lootBoxResult.classList.add('show');
                    
                    // è™•ç†çå‹µ
                    if (selectedItem.type === 'coin') {
                        game.coins += selectedItem.value;
                        showNotification(`ç²å¾— ${selectedItem.value} é‡‘å¹£!`);
                    } else if (selectedItem.type === 'skin') {
                        if (!game.unlockedSkins.includes(selectedItem.value)) {
                            game.unlockedSkins.push(selectedItem.value);
                            showNotification(`è§£é–æ–°çš®è†š: ${selectedItem.value}!`);
                        } else {
                            // å¦‚æœå·²ç¶“æ“æœ‰ï¼Œçµ¦äºˆ200é‡‘å¹£è£œå„Ÿ
                            game.coins += 200;
                            showNotification(`å·²æ“æœ‰è©²çš®è†šï¼Œç²å¾— 200 é‡‘å¹£è£œå„Ÿ!`);
                        }
                    }
                    
                    updateHUD();
                    saveProgress();
                }, 1000);
            } else {
                showNotification(`é‡‘å¹£ä¸è¶³! éœ€è¦ ${price} é‡‘å¹£`, 3000);
            }
        }
        
        // äº‹ä»¶ç›£è½
        playBtn.addEventListener('click', () => {
            mainMenu.style.display = 'none';
            classSelect.style.display = 'flex';
            initClassSelect();
        });
        
        shopBtn.addEventListener('click', () => {
            mainMenu.style.display = 'none';
            shopScreen.style.display = 'flex';
            initShop();
        });
        
        exitBtn.addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦é€€å‡ºéŠæˆ²å—?')) {
                window.close();
            }
        });
        
        backToMenuFromClassBtn.addEventListener('click', () => {
            classSelect.style.display = 'none';
            mainMenu.style.display = 'flex';
        });
        
        backToMenuFromLevelBtn.addEventListener('click', () => {
            levelSelect.style.display = 'none';
            classSelect.style.display = 'flex';
            initClassSelect();
        });
        
        backToMenuFromShopBtn.addEventListener('click', () => {
            shopScreen.style.display = 'none';
            mainMenu.style.display = 'flex';
        });
        
        continueBtn.addEventListener('click', () => {
            levelCompleteScreen.style.display = 'none';
            classSelect.style.display = 'flex';
            initClassSelect();
        });
        
        restartBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            startGame(game.currentLevel);
        });
        
        // è·æ¥­é¸æ“‡
        classContainer.addEventListener('click', (e) => {
            const classCard = e.target.closest('.class-card');
            if (classCard && !classCard.classList.contains('locked')) {
                const classType = classCard.getAttribute('data-class');
                game.selectedClass = classType;
                saveProgress();
                
                // æ›´æ–°é¸ä¸­ç‹€æ…‹
                classContainer.querySelectorAll('.class-card').forEach(card => {
                    card.classList.remove('selected');
                });
                classCard.classList.add('selected');
                
                // é€²å…¥é—œå¡é¸æ“‡
                classSelect.style.display = 'none';
                levelSelect.style.display = 'flex';
                initLevelSelect();
            }
        });
        
        // é—œå¡é¸æ“‡
        levelContainer.addEventListener('click', (e) => {
            const levelBtn = e.target.closest('.level-btn');
            if (levelBtn && !levelBtn.classList.contains('locked')) {
                const level = levelBtn.getAttribute('data-level');
                startGame(level);
            }
        });
        
        // å•†åº—æ¨™ç±¤åˆ‡æ›
        shopTabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                shopTabButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if (btn.getAttribute('data-tab') === 'skins') {
                    skinsTab.style.display = 'flex';
                    lootBoxTab.style.display = 'none';
                } else {
                    skinsTab.style.display = 'none';
                    lootBoxTab.style.display = 'flex';
                }
            });
        });
        
        // çš®è†šé¸æ“‡/è³¼è²·
        skinsTab.addEventListener('click', (e) => {
            const skinCard = e.target.closest('.skin-card');
            if (skinCard) {
                const skin = skinCard.getAttribute('data-skin');
                
                if (skinCard.classList.contains('locked')) {
                    if (skin === 'dragon' && game.unlockedLevels >= 3) {
                        buySkin(skin);
                    } else if (skin === 'alien' && game.unlockedLevels >= 5) {
                        buySkin(skin);
                    } else if (skin === 'ghost' && game.unlockedLevels >= 6) {
                        buySkin(skin);
                    } else {
                        showNotification('å°šæœªè§£é–æ­¤çš®è†š!', 2000);
                    }
                } else {
                    // å·²ç¶“è§£é–ï¼Œé¸æ“‡çš®è†š
                    game.selectedSkin = skin;
                    skinsTab.querySelectorAll('.skin-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    skinCard.classList.add('selected');
                    showNotification(`å·²é¸æ“‡çš®è†š: ${skin}`);
                    saveProgress();
                }
            }
        });
        
        // æŠ½çç®±é¸æ“‡
        lootBoxTab.addEventListener('click', (e) => {
            const lootCard = e.target.closest('.skin-card');
            if (lootCard) {
                const lootType = lootCard.getAttribute('data-loot');
                openLootBox(lootType);
            }
        });
        
        // æŠ½çç®±æŒ‰éˆ•
        buyLootBoxBtn.addEventListener('click', buyLootBox);
        closeLootBoxBtn.addEventListener('click', () => {
            lootBoxScreen.style.display = 'none';
            lootBoxResult.classList.remove('show');
        });
        
        // éµç›¤æ§åˆ¶
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') game.keys.left = true;
            if (e.key === 'ArrowRight') game.keys.right = true;
        });
        
        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') game.keys.left = false;
            if (e.key === 'ArrowRight') game.keys.right = false;
        });
        
        // è§¸æ§æ§åˆ¶
        gameContainer.addEventListener('touchstart', (e) => {
            e.preventDefault();
            game.touchX = e.touches[0].clientX;
            updatePlayerPositionFromTouch();
        });
        
        gameContainer.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (e.touches.length > 0) {
                game.touchX = e.touches[0].clientX;
                updatePlayerPositionFromTouch();
            }
        });
        
        gameContainer.addEventListener('touchend', (e) => {
            e.preventDefault();
            game.touchX = null;
        });
        
        // æ ¹æ“šè§¸æ§ä½ç½®æ›´æ–°ç©å®¶ä½ç½®
        function updatePlayerPositionFromTouch() {
            if (game.touchX !== null) {
                const containerWidth = gameContainer.clientWidth;
                game.playerX = (game.touchX / containerWidth) * 100;
                game.playerX = Math.max(0, Math.min(100, game.playerX));
                updatePlayerPosition();
            }
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        loadProgress();
        initClassSelect();
    </script>
</body>
</html>